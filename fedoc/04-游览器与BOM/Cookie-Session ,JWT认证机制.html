<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>浅谈 Cookie-Session 、Jwt 两种身份认证机制 | 云息的面试资料库</title>
    <meta name="description" content="Code for a better world!">
    <link rel="icon" href="/logo.png">
  <link rel="manifest" href="/manifest.json">
  <meta name="theme-color" content="#3eaf7c">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <link rel="apple-touch-icon" href="/icons/apple-touch-icon-152x152.png">
  <link rel="mask-icon" href="/icons/safari-pinned-tab.svg" color="#3eaf7c">
  <meta name="msapplication-TileImage" content="/icons/msapplication-icon-144x144.png">
  <meta name="msapplication-TileColor" content="#000000">
  <meta name="apple-mobile-web-app-status-bar-style">
    
    <link rel="preload" href="/assets/css/0.styles.05cc7eb5.css" as="style"><link rel="preload" href="/assets/js/app.dcf74adf.js" as="script"><link rel="preload" href="/assets/js/3.d459fbac.js" as="script"><link rel="preload" href="/assets/js/25.b85c6c7a.js" as="script"><link rel="preload" href="/assets/js/6.da654ace.js" as="script"><link rel="prefetch" href="/assets/js/10.726ceeda.js"><link rel="prefetch" href="/assets/js/11.cc1411d8.js"><link rel="prefetch" href="/assets/js/12.2d961c16.js"><link rel="prefetch" href="/assets/js/13.4534349c.js"><link rel="prefetch" href="/assets/js/14.25b1e7f3.js"><link rel="prefetch" href="/assets/js/15.9a2ebaed.js"><link rel="prefetch" href="/assets/js/16.2e7b832c.js"><link rel="prefetch" href="/assets/js/17.c3355b63.js"><link rel="prefetch" href="/assets/js/18.853dd12d.js"><link rel="prefetch" href="/assets/js/19.d6bc92e9.js"><link rel="prefetch" href="/assets/js/20.79e63114.js"><link rel="prefetch" href="/assets/js/21.5b26b4a7.js"><link rel="prefetch" href="/assets/js/22.f545d988.js"><link rel="prefetch" href="/assets/js/23.1ef08a80.js"><link rel="prefetch" href="/assets/js/24.52c1504b.js"><link rel="prefetch" href="/assets/js/26.7e1ce755.js"><link rel="prefetch" href="/assets/js/27.b76dc2c4.js"><link rel="prefetch" href="/assets/js/28.728d4234.js"><link rel="prefetch" href="/assets/js/29.b0d656bb.js"><link rel="prefetch" href="/assets/js/30.86cd0a9c.js"><link rel="prefetch" href="/assets/js/31.18f13b4e.js"><link rel="prefetch" href="/assets/js/32.83a55f7d.js"><link rel="prefetch" href="/assets/js/33.8c2cb966.js"><link rel="prefetch" href="/assets/js/34.749d688a.js"><link rel="prefetch" href="/assets/js/35.0a7990df.js"><link rel="prefetch" href="/assets/js/36.8e1c8cef.js"><link rel="prefetch" href="/assets/js/37.34ec6faf.js"><link rel="prefetch" href="/assets/js/38.8f5ef488.js"><link rel="prefetch" href="/assets/js/39.d32ba925.js"><link rel="prefetch" href="/assets/js/4.79676fe3.js"><link rel="prefetch" href="/assets/js/40.17ab7d00.js"><link rel="prefetch" href="/assets/js/41.68be4954.js"><link rel="prefetch" href="/assets/js/42.da32c428.js"><link rel="prefetch" href="/assets/js/43.3f651e5b.js"><link rel="prefetch" href="/assets/js/44.7e0185a5.js"><link rel="prefetch" href="/assets/js/45.309ead5b.js"><link rel="prefetch" href="/assets/js/46.6f7aeb62.js"><link rel="prefetch" href="/assets/js/47.361ce141.js"><link rel="prefetch" href="/assets/js/48.e6d8a8f3.js"><link rel="prefetch" href="/assets/js/49.33d9f0ac.js"><link rel="prefetch" href="/assets/js/5.51d5e42c.js"><link rel="prefetch" href="/assets/js/50.8b8c70c1.js"><link rel="prefetch" href="/assets/js/51.27f1ce7d.js"><link rel="prefetch" href="/assets/js/52.64320734.js"><link rel="prefetch" href="/assets/js/53.c732a5fa.js"><link rel="prefetch" href="/assets/js/54.541148e9.js"><link rel="prefetch" href="/assets/js/55.36cb41de.js"><link rel="prefetch" href="/assets/js/56.14a7959d.js"><link rel="prefetch" href="/assets/js/57.6a5f2316.js"><link rel="prefetch" href="/assets/js/58.1707cf09.js"><link rel="prefetch" href="/assets/js/59.176b3d1a.js"><link rel="prefetch" href="/assets/js/60.fbfd06af.js"><link rel="prefetch" href="/assets/js/61.c2d4f52a.js"><link rel="prefetch" href="/assets/js/62.0952ea43.js"><link rel="prefetch" href="/assets/js/63.40b1da1b.js"><link rel="prefetch" href="/assets/js/64.a4581053.js"><link rel="prefetch" href="/assets/js/65.72c37f85.js"><link rel="prefetch" href="/assets/js/66.33de2ae0.js"><link rel="prefetch" href="/assets/js/7.aa6f379f.js"><link rel="prefetch" href="/assets/js/8.d5676b08.js"><link rel="prefetch" href="/assets/js/9.e418b8d5.js"><link rel="prefetch" href="/assets/js/vendors~notification.7bcb2342.js">
    <link rel="stylesheet" href="/assets/css/0.styles.05cc7eb5.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">云息的面试资料库</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/fedoc/" class="nav-link router-link-active">指南</a></div><div class="nav-item"><a href="http://yunxi.site/blog/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  博客
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <a href="https://github.com/xiaomuzhu/front-end-interview" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/fedoc/" class="nav-link router-link-active">指南</a></div><div class="nav-item"><a href="http://yunxi.site/blog/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  博客
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <a href="https://github.com/xiaomuzhu/front-end-interview" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>01-计算机网络</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/fedoc/01-计算机网络/CDN和DNS.html" class="sidebar-link">CDN 和 DNS</a></li><li><a href="/fedoc/01-计算机网络/HTTP.html" class="sidebar-link">HTTP</a></li><li><a href="/fedoc/01-计算机网络/前端缓存最佳实践.html" class="sidebar-link">前端缓存最佳实践</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>02-CSS&amp;HTML</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/fedoc/02-CSS&amp;HTML/CSS 基础.html" class="sidebar-link">CSS 基础</a></li><li><a href="/fedoc/02-CSS&amp;HTML/HTML.html" class="sidebar-link">HTML</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>03-JavaScript</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/fedoc/03-JavaScript/JS 继承的八种写法.html" class="sidebar-link">JS 继承的八种写法</a></li><li><a href="/fedoc/03-JavaScript/JS异步编程原理.html" class="sidebar-link">JavaScript 异步编程原理</a></li><li><a href="/fedoc/03-JavaScript/JavaScript基础.html" class="sidebar-link">JS 基础</a></li><li><a href="/fedoc/03-JavaScript/异步-手写async_await.html" class="sidebar-link">异步—手写 async_await</a></li><li><a href="/fedoc/03-JavaScript/异步编程专题.html" class="sidebar-link">JS 异步编程：种类和原理</a></li><li><a href="/fedoc/03-JavaScript/手写系列.html" class="sidebar-link">手写系列</a></li><li><a href="/fedoc/03-JavaScript/防抖节流.html" class="sidebar-link">JavaScript防抖、节流以及rAF</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>04-游览器与BOM</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/fedoc/04-游览器与BOM/Cookie-Session ,JWT认证机制.html" class="active sidebar-link">浅谈 Cookie-Session 、Jwt 两种身份认证机制</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/fedoc/04-游览器与BOM/Cookie-Session ,JWT认证机制.html#跨域认证的问题" class="sidebar-link">跨域认证的问题</a></li><li class="sidebar-sub-header"><a href="/fedoc/04-游览器与BOM/Cookie-Session ,JWT认证机制.html#http-是无状态的协议" class="sidebar-link">HTTP 是无状态的协议</a></li><li class="sidebar-sub-header"><a href="/fedoc/04-游览器与BOM/Cookie-Session ,JWT认证机制.html#cookie-session-机制" class="sidebar-link">Cookie-Session 机制</a></li><li class="sidebar-sub-header"><a href="/fedoc/04-游览器与BOM/Cookie-Session ,JWT认证机制.html#session-cookie-机制的缺陷" class="sidebar-link">Session-Cookie 机制的缺陷</a></li><li class="sidebar-sub-header"><a href="/fedoc/04-游览器与BOM/Cookie-Session ,JWT认证机制.html#jwt-机制" class="sidebar-link">Jwt 机制</a></li><li class="sidebar-sub-header"><a href="/fedoc/04-游览器与BOM/Cookie-Session ,JWT认证机制.html#jwt-特点" class="sidebar-link">JWT 特点</a></li><li class="sidebar-sub-header"><a href="/fedoc/04-游览器与BOM/Cookie-Session ,JWT认证机制.html#复习" class="sidebar-link">复习</a></li></ul></li><li><a href="/fedoc/04-游览器与BOM/Session的概念和安全问题.html" class="sidebar-link">有关 Session 的那些事儿</a></li><li><a href="/fedoc/04-游览器与BOM/V8优化之对象中的快属性与慢属性.html" class="sidebar-link">V8 优化之对象中的快属性与慢属性</a></li><li><a href="/fedoc/04-游览器与BOM/Web Storage 总结.html" class="sidebar-link">Cookie, Session, Web Storage与IndexedDB 总结</a></li><li><a href="/fedoc/04-游览器与BOM/前端安全.html" class="sidebar-link">前端安全</a></li><li><a href="/fedoc/04-游览器与BOM/前端路由的原理.html" class="sidebar-link">前端路由原理及实现</a></li><li><a href="/fedoc/04-游览器与BOM/原生事件.html" class="sidebar-link">原生事件</a></li><li><a href="/fedoc/04-游览器与BOM/跨域.html" class="sidebar-link">跨域</a></li><li><a href="/fedoc/04-游览器与BOM/输入URL1—输入URL和DNS_TCP_HTTP.html" class="sidebar-link">URL1—输入 URL 和游览器</a></li><li><a href="/fedoc/04-游览器与BOM/输入URL2—网络篇.html" class="sidebar-link">URL2—网络篇</a></li><li><a href="/fedoc/04-游览器与BOM/输入URL3—渲染树形成+原理.html" class="sidebar-link">URL3—渲染树形成+原理</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>05-React</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/fedoc/05-React/React基础.html" class="sidebar-link">React 基础</a></li><li><a href="/fedoc/05-React/React进阶.html" class="sidebar-link">React 进阶</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>06-前端工程化</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/fedoc/06-前端工程化/Babel 工作原理.html" class="sidebar-link">Babel 是如何转换代码的？</a></li><li><a href="/fedoc/06-前端工程化/Git.html" class="sidebar-link">Git 相关</a></li><li><a href="/fedoc/06-前端工程化/webpack 的工作原理.html" class="sidebar-link">webpack 的工作原理</a></li><li><a href="/fedoc/06-前端工程化/webpack.html" class="sidebar-link">从零搭建 React 开发环境</a></li><li><a href="/fedoc/06-前端工程化/实现一个简易的webpack可选链loader.html" class="sidebar-link">optional-chaining-loader</a></li><li><a href="/fedoc/06-前端工程化/性能优化总结.html" class="sidebar-link">性能优化总结</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>07-前端架构</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/fedoc/07-前端架构/Node秒杀系统架构.html" class="sidebar-link">Node 秒杀系统架构</a></li><li><a href="/fedoc/07-前端架构/前端监控和埋点方案设计.html" class="sidebar-link">前端监控和前端埋点方案设计</a></li><li><a href="/fedoc/07-前端架构/支付宝架构师眼里的高并发架构.html" class="sidebar-link">支付宝架构师眼里的高并发架构</a></li><li><a href="/fedoc/07-前端架构/架构要考虑什么.html" class="sidebar-link">做架构要考虑什么？</a></li><li><a href="/fedoc/07-前端架构/说说前后端分离.html" class="sidebar-link">说说前后端分离</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>08-Node</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/fedoc/08-Node/Koa2深度解析.html" class="sidebar-link">Koa2 深度解析</a></li><li><a href="/fedoc/08-Node/Koa2源码和原理浅析.html" class="sidebar-link">Koa源码系列1—手写 Koa 库</a></li><li><a href="/fedoc/08-Node/Node.js多进程底层原理.html" class="sidebar-link">Node.js 多进程底层原理</a></li><li><a href="/fedoc/08-Node/Node.js调试之内存泄漏篇.html" class="sidebar-link">Node.js 调试之内存泄漏篇</a></li><li><a href="/fedoc/08-Node/初探 Node.js 中的事件循环.html" class="sidebar-link">初探 Node.js 中的事件循环</a></li><li><a href="/fedoc/08-Node/操作系统.html" class="sidebar-link">操作系统</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>09-算法和数据结构</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/fedoc/09-算法和数据结构/算法.html" class="sidebar-link">算法</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>10-知识广度</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/fedoc/10-知识广度/200409如何在数据库中存储密码更安全.html" class="sidebar-link">如何在数据库中存储密码更安全？</a></li><li><a href="/fedoc/10-知识广度/200410如何设计一个良好的API接口.html" class="sidebar-link">如何设计一个良好的 API 接口？</a></li><li><a href="/fedoc/10-知识广度/200411二维码扫描登录是什么原理.html" class="sidebar-link">二维码扫描登录是什么原理？</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="浅谈-cookie-session-、jwt-两种身份认证机制"><a href="#浅谈-cookie-session-、jwt-两种身份认证机制" aria-hidden="true" class="header-anchor">#</a> 浅谈 Cookie-Session 、Jwt 两种身份认证机制</h1> <p>https://juejin.im/post/5d567e09e51d453c12504dfc</p> <h2 id="跨域认证的问题"><a href="#跨域认证的问题" aria-hidden="true" class="header-anchor">#</a> 跨域认证的问题</h2> <p>互联网服务离不开用户认证。一般流程是下面这样。</p> <blockquote><p>1、用户向服务器发送用户名和密码。</p> <p>2、服务器验证通过后，在当前对话（session）里面保存相关数据，比如用户角色、登录时间等等。</p> <p>3、服务器向用户返回一个 session_id，写入用户的 Cookie。</p> <p>4、用户随后的每一次请求，都会通过 Cookie，将 session_id 传回服务器。</p> <p>5、服务器收到 session_id，找到前期保存的数据，由此得知用户的身份。</p></blockquote> <p>这种模式的问题在于，扩展性（scaling）不好。单机当然没有问题，如果是服务器集群，或者是跨域的服务导向架构，就要求 session 数据共享，每台服务器都能够读取 session。</p> <p>举例来说，A 网站和 B 网站是同一家公司的关联服务。现在要求，用户只要在其中一个网站登录，再访问另一个网站就会自动登录，请问怎么实现？</p> <p>一种解决方案是 session 数据持久化，写入数据库或别的持久层。各种服务收到请求后，都向持久层请求数据。这种方案的优点是架构清晰，缺点是工程量比较大。另外，持久层万一挂了，就会单点失败。</p> <p>另一种方案是服务器索性不保存 session 数据了，所有数据都保存在客户端，每次请求都发回服务器。JWT 就是这种方案的一个代表。</p> <h2 id="http-是无状态的协议"><a href="#http-是无状态的协议" aria-hidden="true" class="header-anchor">#</a> HTTP 是无状态的协议</h2> <p>我们都知道 HTTP 是无状态（<em>stateless</em>）的协议：HTTP 对于事务处理没有记忆能力，不对请求和响应之间的通信状态进行保存。 使用 HTTP 协议，每当有新的请求发送时，就会有对应的新响应产生。协议本身并不保留之前一切的请求或响应报文的信息。这是<strong>为了更快地处理大量事务，确保协议的可伸缩性</strong>，而特意把 HTTP 协议设计成如此简单的。</p> <p>可是，随着 Web 的发展，早期这种无状态的特性却带来了很多不方便性，比如说用户登录新浪微博，在登录页输入用户名、密码之后进入首页，但是由于 HTTP 是无状态的，HTTP 并不知道上一次的 HTTP 请求是否通过了验证，更无法得知当前用户的具体信息。</p> <p>最简单的解决方案就是在所有的请求里面都带上用户名和密码，这样虽然可行，但是大大加重了服务器的负担（对于每个 request 都需要到数据库验证），而且用户也要每进入一个页面输入一次密码，毫无用户体验可言。</p> <p>为此，引入了各种身份认证机制，这里说一下 Cookie-Session 和 Jwt 机制。</p> <h2 id="cookie-session-机制"><a href="#cookie-session-机制" aria-hidden="true" class="header-anchor">#</a> Cookie-Session 机制</h2> <h3 id="什么是-cookie？"><a href="#什么是-cookie？" aria-hidden="true" class="header-anchor">#</a> 什么是 Cookie？</h3> <p><strong>Cookie 是由 HTTP 服务器设置的，保存在浏览器中的小型文本文件</strong>，其内容为一系列的键值对。在 Chrome 中，通过开发者工具 -&gt; Application -&gt; Cookies 可查看</p> <p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gczhphbs8hj311q0fhjx3.jpg" alt="image-20200319200359701"></p> <p>这里简单介绍一下一些字段意思：</p> <p>Expires：Cookie 的过期时间，默认过期时间为用户关闭浏览器时。</p> <p>HttpOnly：指示浏览器不要在除了 HTTP（或者 HTTPS)请求之外暴露 Cookie。通过 JavaScript 脚本无法访问到 Cookie，能有效防止 <a href="https://zh.wikipedia.org/zh-hans/%E8%B7%A8%E7%B6%B2%E7%AB%99%E6%8C%87%E4%BB%A4%E7%A2%BC" target="_blank" rel="noopener noreferrer">XSS 攻击<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>Secure：设置 Cookie 的 Secure 属性为 <code>true</code> 时，意味着 Cookie 通信只限于加密传输，指示浏览器仅仅在通过安全/加密连接才能使用 Cookie。也就是说 Cookie 只有在 HTTPS 协议下才能上传到服务器，而 HTTP 协议下是无法上传的。</p> <h4 id="cookie-传递过程"><a href="#cookie-传递过程" aria-hidden="true" class="header-anchor">#</a> Cookie 传递过程</h4> <ol><li>浏览器向某个 URL 发送请求</li> <li>对应的服务器收到该 HTTP 请求，生成要发给浏览器的 HTTP 响应</li> <li>在响应头中加入 <code>Set-Cookie</code> 字段，值为要设置的的Cookie</li> <li>浏览器收到来自服务器的 HTTP 响应</li> <li>浏览器在响应头中发现了 <code>Set-Cookie</code> 字段，就会将该字段的值保存在内存或者是硬盘中。</li> <li>当下一次向该服务器发送 HTTP 请求时，会将服务器设置的 Cookie 附加在 HTTP 请求的字段 <code>Cookie</code> 中。</li> <li>服务器收到这个 HTTP 请求之后，发现请求头中有 <code>Cookie</code> 字段，就知道了已经处理过这个用户的请求了。</li> <li>过期的 Cookie 会被删除</li></ol> <p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gczhpp5wopj30b405jjrf.jpg" alt="image-20200319200414265"></p> <h3 id="什么是-session？"><a href="#什么是-session？" aria-hidden="true" class="header-anchor">#</a> 什么是 Session？</h3> <p>相对于保存在浏览器中的 Cookie，Session 是存储在服务器端的，避免了在客户端中储存敏感数据。并且存取方式不同，Cookie 只能保存 ASCII 字符串，例如需要存取 Unicode 字符或者二进制数据，需要先进行编码。而Session中能够存取任何类型的数据。Session 一般配合 Cookie 使用，也就是接下来要说到的 Cookie-Session 机制。</p> <h3 id="基于-cookie-session-身份验证机制的过程"><a href="#基于-cookie-session-身份验证机制的过程" aria-hidden="true" class="header-anchor">#</a> 基于 Cookie-Session 身份验证机制的过程</h3> <ol><li>用户输入登录信息</li> <li>服务端验证登录信息是否正确，如果正确就在服务器端为这个用户创建一个 Session，并把 Session 存入数据库</li> <li>服务器端会向客户端返回带有 sessionID 的 Cookie</li> <li>客户端接收到服务器端发来的请求之后，看见响应头中的 <code>Set-Cookie</code> 字段，将 Cookie 保存起来</li> <li>接下来的请求中都会带上这个 Cookie，服务器将 sessionID 和 数据库中的相匹配，如果有效则处理该请求</li> <li>如果用户登出，Session 会在客户端和服务器端都被销毁</li></ol> <h2 id="session-cookie-机制的缺陷"><a href="#session-cookie-机制的缺陷" aria-hidden="true" class="header-anchor">#</a> Session-Cookie 机制的缺陷</h2> <ol><li>扩展性不好，当拥有多台服务器的情况下，如何共享 Session 会成为一个问题，也就是说，用户第一个访问的时候是服务器 A，而第二个请求被转发给了服务器 B，那服务器 B 无法得知其状态。（举例来说，A 网站和 B 网站是同一家公司的关联服务。用户只要在其中一个网站登录，再访问另一个网站自动登录）</li> <li>安全性不好，攻击者可以利用本地 Cookie 进行欺骗和 CSRF 攻击。</li> <li>Session 保存在服务器端，如果短时间内有大量用户，会影响服务器性能。</li> <li><a href="https://juejin.im/post/5c23993de51d457b8c1f4ee1#heading-11" target="_blank" rel="noopener noreferrer">跨域问题<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，Cookie 属于同源策略限制的内容之一。</li></ol> <h2 id="jwt-机制"><a href="#jwt-机制" aria-hidden="true" class="header-anchor">#</a> Jwt 机制</h2> <h3 id="jwt-组成"><a href="#jwt-组成" aria-hidden="true" class="header-anchor">#</a> JWT 组成</h3> <p>JWT 由三个部分组成：header、payload、signature 每个部分中间使用 <code>.</code> 来分隔，其中，header 和 payload 使用 Base64URL 进行编码：</p> <div class="language- extra-class"><pre class="language-text"><code>base64UrlEncode(header).base64UrlEncode(payload).signature
</code></pre></div><h4 id="header"><a href="#header" aria-hidden="true" class="header-anchor">#</a> header</h4> <p>header 部分是一个 JSON 对象，用来描述 JWT 的元数据：</p> <div class="language- extra-class"><pre class="language-text"><code>{
  &quot;typ&quot;: &quot;JWT&quot;,   //  表示对象是一个 JWT
  &quot;alg&quot;: &quot;HS256&quot;  //  表示使用哪种 Hash 算法来创建签名，这里是 HMAC-SHA256
}
复制代码
</code></pre></div><h4 id="payload"><a href="#payload" aria-hidden="true" class="header-anchor">#</a> payload</h4> <p>payload 部分也是一个 JSON 对象，实际需要传递的数据被存放在这里。我们除了使用<a href="https://en.wikipedia.org/wiki/JSON_Web_Token#Standard_fields" target="_blank" rel="noopener noreferrer">官方提供的七个字段<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>之外，也可以使用自定义的私有字段。</p> <div class="language- extra-class"><pre class="language-text"><code>{
  &quot;sub&quot;: &quot;title&quot;,
  &quot;name&quot;: &quot;Yeoman&quot;
}
复制代码
</code></pre></div><p><strong>JWT 默认是不加密的，任何人都可以读到，所以不要把秘密信息放在这个部分。</strong></p> <h4 id="signature"><a href="#signature" aria-hidden="true" class="header-anchor">#</a> signature</h4> <p>signature 是对前两个部分的签名，防止数据被篡改。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>data <span class="token operator">=</span> <span class="token function">base64urlEncode</span><span class="token punctuation">(</span> header <span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;.&quot;</span> <span class="token operator">+</span> <span class="token function">base64urlEncode</span><span class="token punctuation">(</span> payload <span class="token punctuation">)</span><span class="token punctuation">;</span>
signature <span class="token operator">=</span> <span class="token function">Hash</span><span class="token punctuation">(</span> data<span class="token punctuation">,</span> secret <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>使用 Base64URL 编码的 header 和 payload 中间用 <code>.</code> 隔开，再使用 header 中指定的 Hash 算法，加上密钥对这个字符串进行 Hash 得到 signature</p> <h3 id="工作流程"><a href="#工作流程" aria-hidden="true" class="header-anchor">#</a> 工作流程</h3> <ol><li>前端将自己的用户名和密码发送到后端的接口</li> <li>后端核对用户名和密码之后，将用户的一些信息作为 payload，生成 JWT</li> <li>后端将 JWT 作为登录成功的返回结果返回给前端。前端可以将其结果保存在 localStorage/sessionStorage 中，登出时删除 JWT 即可。（最好不要保存在 Cookie 中，用了 Cookie 就不能设置 HTTPonly，并且存在跨域问题）</li> <li>每一次请求都将 JWT 放在 HTTP 请求头中的 <code>Authorization</code> 位，这样相比放在 Cookie 中可以跨域。</li></ol> <div class="language- extra-class"><pre class="language-text"><code>Authorization: Bearer &lt;token&gt;
</code></pre></div><ol><li>服务器解码 JWT，如果 token 有效，那么处理这个请求</li> <li>用户登出，在客户端删除 token 即可，与服务端无关</li></ol> <h2 id="jwt-特点"><a href="#jwt-特点" aria-hidden="true" class="header-anchor">#</a> JWT 特点</h2> <ol><li>JWT 默认是不加密的</li> <li>JWT 的目的是用来验证来源可靠性，并不是保护数据和防止未经授权的访问。（可以类比成一张电影票，只能验证电影票是否是真的，电影票也有一些基本信息，但是他人也可以使用你的电影票，如果可能的话）一旦暴露，任何人都可以获得权限。为了减少盗用，JWT 的有效期应该设置得比较短，对于一些比较重要的权限，使用时应该再次对用户进行认证。</li> <li>最大的缺点是 token 过期处理问题，由于服务器不保存 Session 状态，因此无法在使用过程中废止或者更改权限。也就是说，一旦 JWT 签发了，在到期之前就会始终有效，除非服务器部署额外的逻辑。</li></ol> <h2 id="复习"><a href="#复习" aria-hidden="true" class="header-anchor">#</a> 复习</h2> <p>这里再次复习一下相关知识：</p> <h3 id="同源策略限制的内容"><a href="#同源策略限制的内容" aria-hidden="true" class="header-anchor">#</a> 同源策略限制的内容</h3> <ol><li>Cookie、LocalStorage、SessionStorage、IndexedDB 等存储性内容</li> <li>DOM 节点</li> <li>Ajax 发送请求后，结果被浏览器拦截</li></ol> <h3 id="cookie-和-session-的区别"><a href="#cookie-和-session-的区别" aria-hidden="true" class="header-anchor">#</a> Cookie 和 Session 的区别</h3> <ol><li>存取方式不同：Cookie 只能保存 ASCII 字符串，例如需要存取 Unicode 字符或者二进制数据，需要先进行编码。而Session中能够存取任何类型的数据</li> <li>隐私策略不同：Cookie 存储在浏览器中，Session 存储在服务器上。</li> <li>服务器压力不同：Session 是保管在服务器上的，每个用户都会产生一个 Session 。假如并发访问的用户十分
多，会产生大量的 Session ，耗费大量的内存。</li></ol> <h3 id="分布式情况下的session和token"><a href="#分布式情况下的session和token" aria-hidden="true" class="header-anchor">#</a> 分布式情况下的session和token</h3> <p>我们已经知道session时有状态的，一般存于服务器内存或硬盘中，当服务器采用分布式或集群时，session就会面对负载均衡问题。</p> <p>在互联网公司为了可以支撑更大的流量，后端往往需要多台服务器共同来支撑前端用户请求，那如果用户在 A 服务器登录了，第二次请求跑到服务 B 就会出现登录失效问题。</p> <p>分布式 Session 一般会有以下几种解决方案：</p> <ul><li>Nginx ip_hash 策略，服务端使用 Nginx 代理，每个请求按访问 IP 的 hash 分配，这样来自同一 IP 固定访问一个后台服务器，避免了在服务器 A 创建 Session，第二次分发到服务器 B 的现象。</li> <li>Session 复制，任何一个服务器上的 Session 发生改变（增删改），该节点会把这个 Session 的所有内容序列化，然后广播给所有其它节点。</li> <li>共享 Session，服务端无状态话，将用户的 Session 等信息使用缓存中间件来统一管理，保障分发到每一个服务器的响应结果都一致。</li></ul> <p>建议采用第三种方案。</p> <p>而token是无状态的，token字符串里就保存了所有的用户信息</p> <ul><li>客户端登陆传递信息给服务端，服务端收到后把用户信息加密（token）传给客户端，客户端将token存放于localStroage等容器中。客户端每次访问都传递token，服务端解密token，就知道这个用户是谁了。通过cpu加解密，服务端就不需要存储session占用存储空间，就很好的解决负载均衡多服务器的问题了。这个方法叫做[JWT(Json Web Token)](https://huanqiang.wang/2017/12/28/JWT 介绍/)</li></ul></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/xiaomuzhu/front-end-interview/edit/master/fedoc/04-游览器与BOM/Cookie-Session ,JWT认证机制.md" target="_blank" rel="noopener noreferrer">在 GitHub 上编辑此页</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/fedoc/03-JavaScript/防抖节流.html" class="prev">
          JavaScript防抖、节流以及rAF
        </a></span> <span class="next"><a href="/fedoc/04-游览器与BOM/Session的概念和安全问题.html">
          有关 Session 的那些事儿
        </a>
        →
      </span></p></div> </main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/assets/js/app.dcf74adf.js" defer></script><script src="/assets/js/3.d459fbac.js" defer></script><script src="/assets/js/25.b85c6c7a.js" defer></script><script src="/assets/js/6.da654ace.js" defer></script>
  </body>
</html>
