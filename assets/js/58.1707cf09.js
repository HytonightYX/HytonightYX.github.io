(window.webpackJsonp=window.webpackJsonp||[]).push([[58],{254:function(t,a,e){"use strict";e.r(a);var v=e(4),s=Object(v.a)({},function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h1",{attrs:{id:"二维码扫描登录是什么原理？"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#二维码扫描登录是什么原理？","aria-hidden":"true"}},[t._v("#")]),t._v(" 二维码扫描登录是什么原理？")]),t._v(" "),e("p",[t._v("手机扫描 PC 端 or Web 端账号。")]),t._v(" "),e("p",[t._v("既然是登录认证，本质上就是要做两件事情：")]),t._v(" "),e("ol",[e("li",[t._v("告诉系统我是谁")]),t._v(" "),e("li",[t._v("向系统证明我是谁")])]),t._v(" "),e("p",[t._v("例如，常见的账号密码登录，“账号”就是做 1，“密码”就是做 2。")]),t._v(" "),e("p",[t._v("再比如，手机号登录，“手机号”是做 1，“短信验证码”是做 2。")]),t._v(" "),e("p",[e("strong",[t._v("告诉系统我是谁")])]),t._v(" "),e("p",[t._v("这件事比较好做，因为扫码时，手机肯定要已经登录一个账号 A，这样扫码的时候通过后台可以知道是账号 A 扫描了二维码，需要在 PC 端登录。")]),t._v(" "),e("p",[e("img",{attrs:{src:"http://qn-noter.yunxi.site/imagehost/vml4e.png-style1",alt:"image-20200411114042619"}})]),t._v(" "),e("p",[e("strong",[t._v("向系统证明我是谁")])]),t._v(" "),e("p",[t._v("用户并没有输入密码，或者验证码，那是怎么证明的呢？")]),t._v(" "),e("h2",{attrs:{id:"基于-token-的认证机制"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#基于-token-的认证机制","aria-hidden":"true"}},[t._v("#")]),t._v(" 基于 token 的认证机制")]),t._v(" "),e("p",[t._v("以账号密码登录为例：")]),t._v(" "),e("p",[e("img",{attrs:{src:"http://qn-noter.yunxi.site/imagehost/b7fba.png-style1",alt:"image-20200411210556986"}})]),t._v(" "),e("ol",[e("li",[e("p",[t._v("首次登录，客户端将账号密码和设备信息传递给服务端；")])]),t._v(" "),e("li",[e("p",[t._v("服务端将账号与设备进行绑定，存储在一个数据结构中：")])])]),t._v(" "),e("div",{staticClass:"language-json extra-class"},[e("pre",{pre:!0,attrs:{class:"language-json"}},[e("code",[e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),e("span",{pre:!0,attrs:{class:"token property"}},[t._v('"accountId"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" '账号id'"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token property"}},[t._v('"deviceId"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"登录的设备ID"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token property"}},[t._v('"deviceType"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"设备类型，如ios，android，pc等"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  ...\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),e("ol",{attrs:{start:"3"}},[e("li",[e("p",[t._v("服务端生成一个 "),e("code",[t._v("token")]),t._v("，对应了上面这个账号和设备信息等，并将"),e("code",[t._v("token")]),t._v("返回给客户端；")])]),t._v(" "),e("li",[e("p",[t._v("客户端得到"),e("code",[t._v("token")]),t._v("后，需要进行本地保存，然后在每次发起请求的时的时候都带上这个"),e("code",[t._v("token")]),t._v("；")])]),t._v(" "),e("li",[e("p",[t._v("服务端校验"),e("code",[t._v("token")]),t._v("，通过后返回 API 响应。")])])]),t._v(" "),e("p",[t._v("从这个流程中可以看到，客户端没有必要也不会保存账户密码，而是保存了"),e("code",[t._v("token")]),t._v("。")]),t._v(" "),e("p",[t._v("那么，"),e("code",[t._v("token")]),t._v("被别人知道了咋办？")]),t._v(" "),e("p",[t._v("其实没关系，因为服务端验证还需要"),e("strong",[t._v("设备信息")]),t._v("，这样，别人拿了另一台设备来访问，验证也是通不过的。")]),t._v(" "),e("p",[t._v("可以说，客户端登录的目的，就是"),e("strong",[t._v("去获取属于自己的"),e("code",[t._v("token")])]),t._v("。")]),t._v(" "),e("p",[t._v("同理，扫码登录 PC 端的本质，也是 PC 端去获取属于自己的"),e("code",[t._v("token")]),t._v("。")]),t._v(" "),e("h2",{attrs:{id:"二维码扫描登录原理"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#二维码扫描登录原理","aria-hidden":"true"}},[t._v("#")]),t._v(" 二维码扫描登录原理")]),t._v(" "),e("p",[t._v("PC 端怎么去获取属于自己的"),e("code",[t._v("token")]),t._v("？不可能手机端直接把"),e("code",[t._v("token")]),t._v("分享给 PC 端，因为设备信息是唯一的。")]),t._v(" "),e("p",[t._v("先来看看扫描二维码的一般步骤：")]),t._v(" "),e("ol",{attrs:{start:"0"}},[e("li",[t._v("手机端已登录，PC 端未登录")]),t._v(" "),e("li",[t._v("PC 端展现二维码")]),t._v(" "),e("li",[t._v("手机端扫描二维码")]),t._v(" "),e("li",[t._v("PC 端提示“已扫描，请在手机端确认”")]),t._v(" "),e("li",[t._v("手机端确认登录")]),t._v(" "),e("li",[t._v("PC 端登录成功")])]),t._v(" "),e("h3",{attrs:{id:"生成二维码"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#生成二维码","aria-hidden":"true"}},[t._v("#")]),t._v(" 生成二维码")]),t._v(" "),e("p",[e("img",{attrs:{src:"http://qn-noter.yunxi.site/imagehost/0ct2a.png",alt:"image-20200411211121261"}})]),t._v(" "),e("h3",{attrs:{id:"扫描状态"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#扫描状态","aria-hidden":"true"}},[t._v("#")]),t._v(" 扫描状态")]),t._v(" "),e("p",[e("img",{attrs:{src:"http://qn-noter.yunxi.site/imagehost/saw8t.png",alt:"image-20200411211303084"}})]),t._v(" "),e("p",[t._v("那么为什么要生成临时 "),e("code",[t._v("token")]),t._v("呢？")]),t._v(" "),e("p",[t._v("临时"),e("code",[t._v("token")]),t._v("的特定在于，它只能用一次，用过就失效。")]),t._v(" "),e("p",[t._v("所以，给手机端返回临时"),e("code",[t._v("token")]),t._v("可以确保扫码与登录的两步操作是同一个手机端发出的。")]),t._v(" "),e("h3",{attrs:{id:"登录"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#登录","aria-hidden":"true"}},[t._v("#")]),t._v(" 登录")]),t._v(" "),e("p",[e("img",{attrs:{src:"http://qn-noter.yunxi.site/imagehost/diq75.png",alt:"image-20200411211350141"}})]),t._v(" "),e("p",[t._v("1、二维码状态有三种:待扫描、已扫描待确认、已确认;\n2、待扫描:PC 端携带设备信息向服务端发送请求,服务端生成二维码 ID 与设备信息进行绑定,将二维码 ID 返回给 PC 端,PC 端已二维码的形式显示二维码;\n3、PC 端通过轮询的方式向服务端查询二维码的状态是否发生变化;\n4、移动端扫描 PC 端二维码,获取到二维码 ID,移动端带二维码 ID+移动端身份信息(token)发送给服务端,服务端验证身份信息通过后,将二维码 ID 与身份信息绑定,并生成临时 token 返回给移动端,二维码状态变为已扫描待确认;\n5、移动端确认登录,并携带临时 token 请求服务端,服务端验证临时 token 通过后,改变二维码状态为已确认并生成 PCtoken,PC 端通过轮询知二维码状态.当为已确认状态时,返回 PCtoken,后续 PC 端通过 token 可以返回 API;")]),t._v(" "),e("h2",{attrs:{id:"总结"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#总结","aria-hidden":"true"}},[t._v("#")]),t._v(" 总结")]),t._v(" "),e("p",[e("img",{attrs:{src:"http://qn-noter.yunxi.site/imagehost/gk2a5.png",alt:"image-20200411212304473"}})])])},[],!1,null,null,null);a.default=s.exports}}]);